package com.onemore.msnaves.mensajes.service;

import org.springframework.stereotype.Service;

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;

@Service
public class MensajesService implements IMensajesService {
	
	private final static String HOST = "localhost";
	private final static String QUEUE_INFO = "QUEUE_INFO";
	private final static String QUEUE_ELIMINACION_USUARIOS = "QUEUE_ELIMINACION_USUARIOS";

	public void send(String mensaje) {
		ConnectionFactory factory = new ConnectionFactory();
		factory.setHost(HOST);
		try (
			Connection connection = factory.newConnection(); 
			Channel channel = connection.createChannel()) {
			channel.queueDeclare(QUEUE_INFO, false, false, false, null);
			channel.basicPublish("", QUEUE_INFO, null, mensaje.getBytes());
			System.out.println(" [o] Enviado a QUEUE_INFO: '" + mensaje + "'");
		} catch (Exception e) {
			e.printStackTrace();
		}
    }
	
	public void sendEliminacionUsuario(String mensaje) {
		ConnectionFactory factory = new ConnectionFactory();
		factory.setHost(HOST);
		try (
			Connection connection = factory.newConnection(); 
			Channel channel = connection.createChannel()) {
			channel.queueDeclare(QUEUE_ELIMINACION_USUARIOS, false, false, false, null);
			channel.basicPublish("", QUEUE_ELIMINACION_USUARIOS, null, mensaje.getBytes());
			System.out.println(" [o] Enviado a QUEUE_ELIMINACION_USUARIOS: '" + mensaje + "'");
		} catch (Exception e) {
			e.printStackTrace();
		}
    }

}
